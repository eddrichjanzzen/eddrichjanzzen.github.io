<!DOCTYPE html>
<html lang="en-ca">
  
  <head>
  <meta charset="utf-8">
  <!-- Begin Jekyll SEO tag v2.5.0 -->
<title>Implementing simple API using Python Falcon | Eddrich Janzzen</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="Implementing simple API using Python Falcon" />
<meta name="author" content="eddrichjanzzen" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="A short article about implementing API using Python Falcon" />
<meta property="og:description" content="A short article about implementing API using Python Falcon" />
<link rel="canonical" href="https://eddrichjanzzen.github.io/blog/2020/06/26/Simple-CRUD-python-falcon.html" />
<meta property="og:url" content="https://eddrichjanzzen.github.io/blog/2020/06/26/Simple-CRUD-python-falcon.html" />
<meta property="og:site_name" content="Eddrich Janzzen" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-06-26T00:00:00+00:00" />
<script type="application/ld+json">
{"description":"A short article about implementing API using Python Falcon","headline":"Implementing simple API using Python Falcon","dateModified":"2020-06-26T00:00:00+00:00","datePublished":"2020-06-26T00:00:00+00:00","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://eddrichjanzzen.github.io/blog/2020/06/26/Simple-CRUD-python-falcon.html"},"url":"https://eddrichjanzzen.github.io/blog/2020/06/26/Simple-CRUD-python-falcon.html","author":{"@type":"Person","name":"eddrichjanzzen"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->

  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <link rel="icon" href="/images/favicon.ico">
  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Raleway:200,700" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Roboto:300,700" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@100;400" rel="stylesheet">
  <!-- CSS -->
  <link rel="stylesheet" href="/css/normalize.css">
  <link rel="stylesheet" href="/css/skeleton.css">
  <link rel="stylesheet" href="/css/skeleton-alerts.css">
  <link rel="stylesheet" href="/css/common.css">
  <!-- for syntax highlighting -->
  <link rel="stylesheet" href="/css/tango.css">
  <script src="/js/jquery-3.1.1.min.js"></script> 
  <script src="/js/main.js"></script>  

  <meta name="google-site-verification" content="y76HL_x2Anjbw7oIO9lswptVVKHz5NHCzh8Dz9Rp4FI" />

  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-171515307-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-171515307-1');
  </script>

  
</head>


<body>

  <header>
    <nav>
	
	<div class="hamburger">
		<div class="line"></div>
		<div class="line"></div>
		<div class="line"></div>
	</div>
	
	
	<ul class="clearfix nav-top">
	<!-- <ul class="open nav-top"> -->
		<li><a href="/index.html">Home</a></li>
    <li><a href="/posts">Posts</a></li>
		<li><a href="/projects.html">Projects</a></li>
		<li><a href="https://github.com/eddrichjanzzen" target="_blank">GitHub</a></li>
		<li><a href="/contact.html">Contact</a></li>
	</ul>
</nav>


<!-- https://www.youtube.com/watch?v=6m6iqN1uynE -->

  </header>


  <div class="content-wrapper">
    <h3>Implementing simple API using Python Falcon</h3>
<span>Posted on Jun 26, 2020 • eddrichjanzzen
</span>
<br><br>

<div class="blog-wrapper">
	<p>The advent of technology has produced many different programming languages that developers can use. From the low level languages such as C, C++, and Assembly Language, to the more high level languages such as Ruby and Python, indeed, technology has reached new heights.</p>

<p><img src="/assets/images/python-logo.png" alt="Python" class="img-blog-right"></p>

<p>One of the emerging programming languages in modern day is Python. It has gained its popularity for being simple yet at the same time very expressive. It is simple in the sense that the code resembles how humans think, which makes it very human understandable. It is expressive in the sense that it enables developers to write fewer lines of code for tasks that require more code in other languages. For these reasons, Python has been adopted as a language commonly used to build simple yet powerful scripts. As a matter of fact, it has become one of the staple tools in the field of data science; used to perform complex tasks such as data cleaning, machine learning, and even building neural networks.</p>

<p>However, one of the underrated capabilities that not everyone sees, is how Python can be used to create simple and powerful APIs. Using libraries such as Python Django, Python Flask, one can develop simple back-ends fewer lines of code compared to other languages. The simple yet expressive nature of Python make it one of the few ideal languages for microservice architectures.</p>

<h4 id="python-falcon">Python Falcon</h4>
<p><img src="/assets/images/falcon.jpg" alt="Falcon" class="img-blog"></p>

<p>In today’s article, we will be talking about an emerging framework for building simple APIs. We will be going through how to set up a simple API with Create, Read, Update, and Delete functionalities using the <a href="https://falconframework.org/#sectionAbout">Python Falcon</a> framework.</p>

<p>What is Falcon?</p>

<p>Falcon is a minimalist microframework designed to support the demanding needs of large scale microservices. It is fast and reliable because it compiles with Cython when available. Based on benchmarking tests, Falcon is able to outperform some of the famous microframeworks such as Bottle, Flask, and Werkzeug.</p>

<p>The speed up is just insane. For large scale microservices with high traffic, Falcon is the way to go. <img class="emoji" title=":raised_hands:" alt=":raised_hands:" src="https://github.githubassets.com/images/icons/emoji/unicode/1f64c.png" height="20" width="20"> <a href="https://falconframework.org/#sectionBenchmarks">Read more</a></p>

<h4 id="setting-up">Setting up</h4>

<p>Falcon’s architecture follows certain concepts from the REST architectural style. Important to both REST and the falcon framework is the concept of “resource”. A resource is simply everything the system would need that can be accessed by a url.</p>

<p>Behind this is a “resource controller” which is controls how the resources behave. It is in charge of orchestrating the requested action and composing a valid result.</p>

<p>Below is an example of a resource controller:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">ProductResource</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
	
	<span class="k">def</span> <span class="nf">on_get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">req</span><span class="p">,</span> <span class="n">resp</span><span class="p">):</span>

		<span class="k">try</span><span class="p">:</span>
			<span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">"Performing get all products..."</span><span class="p">)</span>
			
			<span class="n">resp</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="n">ujson</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s">'products'</span><span class="p">:</span> <span class="n">products</span><span class="p">})</span>
			<span class="n">resp</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">falcon</span><span class="o">.</span><span class="n">HTTP_200</span>

		<span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>

			<span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

			<span class="n">resp</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="n">ujson</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s">"error"</span><span class="p">:</span> <span class="n">e</span><span class="p">})</span>
			<span class="n">resp</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">falcon</span><span class="o">.</span><span class="n">HTTP_502</span>


	<span class="k">def</span> <span class="nf">on_get_product</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">req</span><span class="p">,</span> <span class="n">resp</span><span class="p">,</span> <span class="n">product_id</span><span class="p">):</span>

		<span class="k">try</span><span class="p">:</span>
			<span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">"Performing get product..."</span><span class="p">)</span>
			
			<span class="n">product</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">products</span> <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s">'id'</span><span class="p">])</span> <span class="o">==</span> <span class="nb">str</span><span class="p">(</span><span class="n">product_id</span><span class="p">)]</span>

			<span class="k">if</span> <span class="n">product</span> <span class="o">==</span> <span class="p">[]:</span>

				<span class="n">resp</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="n">ujson</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s">'error'</span><span class="p">:</span> <span class="s">'product not found.'</span><span class="p">})</span>
				<span class="n">resp</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">falcon</span><span class="o">.</span><span class="n">HTTP_404</span>

			<span class="k">else</span><span class="p">:</span> 

				<span class="n">resp</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="n">ujson</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s">'products'</span><span class="p">:</span> <span class="n">product</span><span class="p">[</span><span class="mi">0</span><span class="p">]})</span>
				<span class="n">resp</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">falcon</span><span class="o">.</span><span class="n">HTTP_200</span>



		<span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>

			<span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

			<span class="n">resp</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="n">ujson</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s">"error"</span><span class="p">:</span> <span class="n">e</span><span class="p">})</span>
			<span class="n">resp</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">falcon</span><span class="o">.</span><span class="n">HTTP_502</span>


	<span class="k">def</span> <span class="nf">on_post</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">req</span><span class="p">,</span> <span class="n">resp</span><span class="p">):</span>

		<span class="k">try</span><span class="p">:</span>
			<span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">"Performing post request..."</span><span class="p">)</span>

			<span class="n">body</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="s">'request'</span><span class="p">]</span>

			<span class="n">product</span> <span class="o">=</span> <span class="p">{</span>
				<span class="s">'id'</span><span class="p">:</span> <span class="n">body</span><span class="p">[</span><span class="s">'id'</span><span class="p">],</span>
				<span class="s">'name'</span><span class="p">:</span> <span class="n">body</span><span class="p">[</span><span class="s">'name'</span><span class="p">],</span>
				<span class="s">'stock'</span> <span class="p">:</span> <span class="n">body</span><span class="p">[</span><span class="s">'stock'</span><span class="p">],</span>
				<span class="s">'price'</span> <span class="p">:</span> <span class="n">body</span><span class="p">[</span><span class="s">'price'</span><span class="p">]</span>
			<span class="p">}</span>

			<span class="n">products</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">product</span><span class="p">)</span>

			<span class="n">resp</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="n">ujson</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span>
				<span class="s">'products'</span><span class="p">:</span> <span class="n">product</span><span class="p">,</span>
				<span class="s">'status'</span><span class="p">:</span> <span class="s">'CREATED OK'</span>
			<span class="p">})</span>


			<span class="n">resp</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">falcon</span><span class="o">.</span><span class="n">HTTP_200</span>

		<span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>

			<span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

			<span class="n">resp</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="n">ujson</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s">"error"</span><span class="p">:</span> <span class="s">"connection error"</span><span class="p">})</span>
			<span class="n">resp</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">falcon</span><span class="o">.</span><span class="n">HTTP_502</span>


	<span class="k">def</span> <span class="nf">on_put_product</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">req</span><span class="p">,</span> <span class="n">resp</span><span class="p">,</span> <span class="n">product_id</span><span class="p">):</span>
		
		<span class="k">try</span><span class="p">:</span>
			<span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">"Performing put request..."</span><span class="p">)</span>

			<span class="n">body</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="s">'request'</span><span class="p">]</span>

			<span class="n">product</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">products</span> <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s">'id'</span><span class="p">])</span> <span class="o">==</span> <span class="nb">str</span><span class="p">(</span><span class="n">product_id</span><span class="p">)]</span>

			<span class="k">if</span> <span class="n">product</span> <span class="o">==</span> <span class="p">[]:</span>

				<span class="n">resp</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="n">ujson</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s">'error'</span><span class="p">:</span> <span class="s">'product not found.'</span><span class="p">})</span>
				<span class="n">resp</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">falcon</span><span class="o">.</span><span class="n">HTTP_404</span>

			<span class="k">else</span><span class="p">:</span> 

				<span class="n">product</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">'name'</span><span class="p">]</span> <span class="o">=</span> <span class="n">body</span><span class="p">[</span><span class="s">'name'</span><span class="p">]</span>
				<span class="n">product</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">'stock'</span><span class="p">]</span> <span class="o">=</span> <span class="n">body</span><span class="p">[</span><span class="s">'stock'</span><span class="p">]</span>
				<span class="n">product</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">'price'</span><span class="p">]</span> <span class="o">=</span> <span class="n">body</span><span class="p">[</span><span class="s">'price'</span><span class="p">]</span>

				<span class="n">resp</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="n">ujson</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span>
					<span class="s">'products'</span><span class="p">:</span> <span class="n">product</span><span class="p">,</span>
					<span class="s">'status'</span><span class="p">:</span> <span class="s">'UPDATED OK'</span>
				<span class="p">})</span>

				<span class="n">resp</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">falcon</span><span class="o">.</span><span class="n">HTTP_200</span>

		<span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>

			<span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

			<span class="n">resp</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="n">ujson</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s">"error"</span><span class="p">:</span> <span class="n">e</span><span class="p">})</span>
			<span class="n">resp</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">falcon</span><span class="o">.</span><span class="n">HTTP_502</span>

	<span class="k">def</span> <span class="nf">on_delete_product</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">req</span><span class="p">,</span> <span class="n">resp</span><span class="p">,</span> <span class="n">product_id</span><span class="p">):</span>

		<span class="k">try</span><span class="p">:</span>
			<span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">"Performing delete request..."</span><span class="p">)</span>

			<span class="n">product</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">products</span> <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s">'id'</span><span class="p">])</span> <span class="o">==</span> <span class="nb">str</span><span class="p">(</span><span class="n">product_id</span><span class="p">)]</span>

			<span class="k">if</span> <span class="n">product</span> <span class="o">==</span> <span class="p">[]:</span>

				<span class="n">resp</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="n">ujson</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s">'error'</span><span class="p">:</span> <span class="s">'product not found.'</span><span class="p">})</span>
				<span class="n">resp</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">falcon</span><span class="o">.</span><span class="n">HTTP_404</span>

			<span class="k">else</span><span class="p">:</span>

				<span class="n">products</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">product</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

				<span class="n">resp</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="n">ujson</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span>
					<span class="s">'products'</span><span class="p">:</span> <span class="n">product</span><span class="p">,</span>
					<span class="s">'status'</span><span class="p">:</span> <span class="s">'DELETED OK'</span>
				<span class="p">})</span>

			<span class="n">resp</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">falcon</span><span class="o">.</span><span class="n">HTTP_200</span>

		<span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>

			<span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

			<span class="n">resp</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="n">ujson</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s">"error"</span><span class="p">:</span> <span class="n">e</span><span class="p">})</span>
			<span class="n">resp</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">falcon</span><span class="o">.</span><span class="n">HTTP_502</span>

</code></pre></div></div>

<p>The code above shows different functions that correspond to certain HTTP methods for a products API. For example: <code class="language-plaintext highlighter-rouge">on_get_product</code>, <code class="language-plaintext highlighter-rouge">on_post_product</code>, <code class="language-plaintext highlighter-rouge">on_put_product</code>, <code class="language-plaintext highlighter-rouge">on_delete_product</code>, etc., are functions that implement business logic for creating, reading, updating, and deleting products.</p>

<p>Once the resource controller has been configured, we can then define a file called <code class="language-plaintext highlighter-rouge">app.py</code>, which will instantiate our product resource controller.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">falcon</span>
<span class="kn">import</span> <span class="nn">json_utils</span>
<span class="kn">from</span> <span class="nn">decouple</span> <span class="kn">import</span> <span class="n">config</span>
<span class="kn">from</span> <span class="nn">product_resource</span> <span class="kn">import</span> <span class="n">ProductResource</span>


<span class="c1"># Declare Falcon Middleware 
# RequireJSON will always make sure the application data is in JSON format
# JSONtranslator will translate the stream data from falcon into JSON format
</span><span class="n">api</span> <span class="o">=</span> <span class="n">falcon</span><span class="o">.</span><span class="n">API</span><span class="p">(</span><span class="n">middleware</span><span class="o">=</span><span class="p">[</span>
			<span class="n">json_utils</span><span class="o">.</span><span class="n">RequireJSON</span><span class="p">(),</span>
			<span class="n">json_utils</span><span class="o">.</span><span class="n">JSONtranslator</span><span class="p">(),</span>
		<span class="p">])</span>

<span class="c1"># we define our resource here
</span><span class="n">product</span> <span class="o">=</span> <span class="n">ProductResource</span><span class="p">()</span>

<span class="n">api</span><span class="o">.</span><span class="n">add_route</span><span class="p">(</span><span class="s">'/products'</span><span class="p">,</span> <span class="n">product</span><span class="p">)</span>
<span class="n">api</span><span class="o">.</span><span class="n">add_route</span><span class="p">(</span><span class="s">'/products/{product_id}'</span><span class="p">,</span> <span class="n">product</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="s">"product"</span><span class="p">)</span>

</code></pre></div></div>

<p>Note that we can define routes as needed using the <code class="language-plaintext highlighter-rouge">add_route</code> function.</p>

<p>Lastly, for the API to function efficiently, we must add two middlewares:</p>

<p><code class="language-plaintext highlighter-rouge">RequireJSON()</code> and <code class="language-plaintext highlighter-rouge">JSONtranslator</code>, these middlewares are used to process our json objects. Since Falcon processes request and response data as a stream of bytes, there is a need to perform some serialization to ensure that the data being sent and being serialized in json format; this is handled by <code class="language-plaintext highlighter-rouge">JSONtranslator</code>. On the otherhand, we must also validate that the request being accepted is in json format; this is handled by <code class="language-plaintext highlighter-rouge">RequireJSON()</code></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">falcon</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">decimal</span>

<span class="c1"># Middle ware classes for processing json objects
</span>

<span class="c1"># This will read the stream from the request, then it will decode this data into json format
# If it cannot decode, it will return an TypeError
</span>
<span class="k">class</span> <span class="nc">JSONtranslator</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">process_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">req</span><span class="p">,</span> <span class="n">resp</span><span class="p">):</span>
        <span class="s">"""
        req.stream corresponds to the WSGI wsgi.input environ variable,
        and allows you to read bytes from the request body.
        See also: PEP 3333
        """</span>
        <span class="k">if</span> <span class="n">req</span><span class="o">.</span><span class="n">content_length</span> <span class="ow">in</span> <span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">return</span>

        <span class="n">body</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">body</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">falcon</span><span class="o">.</span><span class="n">HTTPBadRequest</span><span class="p">(</span>
                <span class="s">'Empty request body. A valid JSON document is required.'</span>
            <span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># You can access the request data using req.context['request']
</span>            <span class="n">req</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="s">'request'</span><span class="p">]</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">body</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s">'utf-8'</span><span class="p">))</span>

        <span class="k">except</span> <span class="p">(</span><span class="nb">ValueError</span><span class="p">,</span> <span class="nb">UnicodeDecodeError</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">falcon</span><span class="o">.</span><span class="n">HTTPError</span><span class="p">(</span>
                <span class="n">falcon</span><span class="o">.</span><span class="n">HTTP_753</span><span class="p">,</span>
                <span class="s">'Malformed JSON. Could not decode the request body.'</span>
                <span class="s">'The JSON was incorrect or not encoded as UTF-8.'</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">process_response</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">req</span><span class="p">,</span> <span class="n">resp</span><span class="p">,</span> <span class="n">resource</span><span class="p">,</span> <span class="n">req_succeeded</span><span class="p">):</span>
        <span class="k">if</span> <span class="s">'response'</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">resp</span><span class="o">.</span><span class="n">context</span><span class="p">:</span>
            <span class="k">return</span>
        
        <span class="n">resp</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span>
            <span class="n">resp</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="s">'response'</span><span class="p">],</span>
            <span class="n">default</span><span class="o">=</span><span class="n">json_serializer</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">json_serializer</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">decimal</span><span class="o">.</span><span class="n">Decimal</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>

        <span class="k">raise</span> <span class="nb">TypeError</span><span class="p">(</span><span class="s">'Cannot serialize {!r} (type {})'</span><span class="o">.</span><span class="nb">format</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">obj</span><span class="p">)))</span>


<span class="k">class</span> <span class="nc">RequireJSON</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">process_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">req</span><span class="p">,</span> <span class="n">resp</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">req</span><span class="o">.</span><span class="n">client_accepts_json</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">falcon</span><span class="o">.</span><span class="n">HTTPNotAcceptable</span><span class="p">(</span>
                <span class="s">'This API only supports responses encoded as JSON.'</span><span class="p">,</span>
                <span class="n">href</span><span class="o">=</span><span class="s">'http://docs.examples.com/api/json'</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">req</span><span class="o">.</span><span class="n">method</span> <span class="ow">in</span> <span class="p">(</span><span class="s">'POST'</span><span class="p">,</span> <span class="s">'PUT'</span><span class="p">):</span>
            <span class="k">if</span> <span class="s">'application/json'</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">req</span><span class="o">.</span><span class="n">content_type</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">falcon</span><span class="o">.</span><span class="n">HTTPUnsupportedMediaType</span><span class="p">(</span>
                    <span class="s">'This API only supports requests encoded as JSON.'</span><span class="p">,</span>
                    <span class="n">href</span><span class="o">=</span><span class="s">'http://docs.examples.com/api/json'</span><span class="p">)</span>
</code></pre></div></div>

<p>There you have it. You have just completed setting up your Falcon API. <img class="emoji" title=":clap:" alt=":clap:" src="https://github.githubassets.com/images/icons/emoji/unicode/1f44f.png" height="20" width="20"> <img class="emoji" title=":clap:" alt=":clap:" src="https://github.githubassets.com/images/icons/emoji/unicode/1f44f.png" height="20" width="20"> <img class="emoji" title=":clap:" alt=":clap:" src="https://github.githubassets.com/images/icons/emoji/unicode/1f44f.png" height="20" width="20"></p>

<h4 id="wrapping-up">Wrapping up</h4>

<p>Python Falcon is a simple framework that boasts to be blazing fast and highly reliable. It is also easily extensible which makes it one of the ideal choices for large scale microservices.</p>

<p>For more details, you may visit my sample project. <a href="https://github.com/eddrichjanzzen/python-falcon-sample">https://github.com/eddrichjanzzen/python-falcon-sample</a></p>
	
</div>

  <div>
  
  <footer>
  
<footer class="footer">
	<nav>
	
	
	<ul class="clearfix nav-bottom">
	<!-- <ul class="open nav-top"> -->
		<li><a href="/index.html">Home</a></li>
    <li><a href="/posts">Posts</a></li>
		<li><a href="/projects.html">Projects</a></li>
		<li><a href="https://github.com/eddrichjanzzen" target="_blank">GitHub</a></li>
		<li><a href="/contact.html">Contact</a></li>
	</ul>
</nav>


<!-- https://www.youtube.com/watch?v=6m6iqN1uynE -->

	<div class="mini">
		<img src="/images/me.jpg" alt="">
		<p>Developed by <a href="https://github.com/eddrichjanzzen">Eddrich Janzzen Ang</a> powered by <a href="https://jekyllrb.com/">Jekyll</a></p>	
	</div>
</footer>


  <footer>

</footer></footer>
</div>
</div></body>
<script src="/js/main.js"></script>
</html>